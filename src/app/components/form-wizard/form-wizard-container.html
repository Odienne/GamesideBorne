<form-wizard (messageEvent)="receiveMessage($event)" [linear]="linearMode">
  <cdk-step [stepControl]="form">
    <div class="step-container">
      <div>
        <h1 class="step-title">Combien d'équipes dans votre groupe ?</h1>
      </div>

      <div class="manage-nbTeams-container">
        <button (click)="minusOneTeam()">
          <img class="icon minus" src="./assets/icons/minus.svg" alt="">
        </button>
        <div>
          <span class="nbTeams-value">
            {{ nbTeams }}
          </span>
        </div>
        <button (click)="addOneTeam()">
          <img class="icon plus" src="./assets/icons/plus.svg" alt="">
        </button>
      </div>

      <div class="flex-container">
        <form [formGroup]="form" class="custom-form" (ngSubmit)="submitForm()">

          <div class="flex-container" *ngIf="nbTeams > 1">
            <input class="custom-text-input" autofocus required type="text" formControlName="groupName"
                   placeholder="Nom du groupe (ex: Anniversaire Maxime, EVJF Marie...)"
                   ngxTouchKeyboard
                   ngxTouchKeyboardFullScreen
                   inputmode='text'
                   #touchKeyboard="ngxTouchKeyboard"
                   (focus)="touchKeyboard.openPanel()"
            >
          </div>

          <button class="valid-btn" cdkStepperNext [disabled]="!this.form.valid">
            Valider
          </button>
        </form>
      </div>
    </div>
  </cdk-step>
  <cdk-step [stepControl]="gameModeForm">
    <div class="step-container">
      <div>
        <h1 class="step-title">Choississez votre mode de jeu</h1>
      </div>

      <div class="flex-container">
        <form [formGroup]="gameModeForm" class="custom-form">

          <div class="gamemode-container">
            <label class="gamemode {{gameModeForm.value.gamemode === 'classique' ? 'selected' : ''}}" for="gamemode1">

              <span (click)="toggleInfoModal()">
                <img class="icon info" src="./assets/icons/information.svg" alt="">
              </span>

              <div class="card-header normal">
                <img src="/assets/icons/man.svg" alt="" class="center-icon">
              </div>
              <div class="card-footer">
                <p class="card-footer-title">Mode de jeu classique</p>
              </div>
            </label>

            <label class="gamemode {{gameModeForm.value.gamemode === 'halloween' ? 'selected' : ''}}" for="gamemode2">
              <span (click)="toggleInfoModal()">
                <img class="icon info" src="./assets/icons/information.svg" alt="">
              </span>

              <div class="card-header halloween">
                <img src="/assets/icons/ghost.svg" alt="" class="center-icon">
                <div class="ribbon ribbon-top-right"><span>Coming soon</span></div>
              </div>
              <div class="card-footer">
                <p class="card-footer-title edoSZ">Mode de jeu Halloween</p>
              </div>
            </label>
          </div>

          <input id="gamemode1" hidden name="gamemode" formControlName="gamemode" type="radio" value="classique">
          <input id="gamemode2" hidden name="gamemode" formControlName="gamemode" type="radio" value="halloween">

          <button class="valid-btn" cdkStepperNext [disabled]="gameModeForm.invalid">
            Valider
          </button>
        </form>
      </div>
    </div>

    <div class="modal" *ngIf="infoModalVisibility">
      <!-- Modal content -->
      <div class="modal-container">
        <div class="modal-content">
          <span (click)="toggleInfoModal()">
          <img class="icon info" src="./assets/icons/close_modal.svg" alt="">
        </span>

          <div class="modal-header with-bg">
            <p class="modal-text">
              L’Action side avec les régles de bases.
              <br>
              <br>

              16 salles sur plus de 600m2 pour s’affronter en équipes
              dans des univers thématiques ultra immersifs :
              Magic School, Indiana Run, Stars Zone ou
              Pirate Bay, il y en a pour tous les goûts !
            </p>
          </div>
          <div class="modal-footer">
            <p>
              Mode de jeu Classique
            </p>
          </div>
        </div>
      </div>
    </div>
  </cdk-step>

  <div *ngFor="let team of teams; index as i">
    <cdk-step [stepControl]="teamDetailsForm">
      <div class="step-container">
        <div>
          <h1 class="step-title">Composez votre <span class="team-name">{{ team.id }}</span></h1>
        </div>

        <div class="flex-container">
          <form [formGroup]="teamDetailsForm" class="custom-form" (ngSubmit)="submitTeamDetailsForm(team.id)">
            <p class="step-subtitle">Nombre de joueurs</p>
            <div class="flex-row label-container">
              <label class="nb-player-label {{teamDetailsForm.value.nbPlayer == 2 ? 'selected' : ''}}" for="nbPlayer2">
                2
              </label>
              <label class="nb-player-label {{teamDetailsForm.value.nbPlayer == 3 ? 'selected' : ''}}" for="nbPlayer3">
                3
              </label>
              <label class="nb-player-label {{teamDetailsForm.value.nbPlayer == 4 ? 'selected' : ''}}" for="nbPlayer4">
                4
              </label>
              <label class="nb-player-label {{teamDetailsForm.value.nbPlayer == 5 ? 'selected' : ''}}" for="nbPlayer5">
                5
              </label>
            </div>

            <input id="nbPlayer2" hidden name="nbPlayer" formControlName="nbPlayer" type="radio" value="2">
            <input id="nbPlayer3" hidden name="nbPlayer" formControlName="nbPlayer" type="radio" value="3">
            <input id="nbPlayer4" hidden name="nbPlayer" formControlName="nbPlayer" type="radio" value="4">
            <input id="nbPlayer5" hidden name="nbPlayer" formControlName="nbPlayer" type="radio" value="5">

            <input class="custom-text-input" type="text" formControlName="teamName" placeholder="Nom de l'équipe"
                   required
                   ngxTouchKeyboard
                   ngxTouchKeyboardFullScreen
                   inputmode='text'
                   #touchKeyboard="ngxTouchKeyboard"
                   (focus)="touchKeyboard.openPanel()"
                   (blur)="touchKeyboard.closePanel()"
            >
            <input class="custom-text-input" type="email" formControlName="teamEmail"
                   placeholder="Email (pour recevoir votre fiche des scores)"
                   required
                   ngxTouchKeyboard
                   ngxTouchKeyboardFullScreen
                   inputmode='email'
                   #touchKeyboard2="ngxTouchKeyboard"
                   (focus)="touchKeyboard2.openPanel()"
                   (blur)="touchKeyboard2.closePanel()"
            >

            <button class="valid-btn" cdkStepperNext [disabled]="teamDetailsForm.invalid">
              Valider
            </button>
          </form>
        </div>
      </div>
    </cdk-step>
    <cdk-step [stepControl]="teamDetailsForm">
      <div class="step-container">
        <div>
          <h1 class="step-title">{{ team.id }} {{ teamDetailsForm.value.teamName }}</h1>
        </div>

        <p class="step-subtitle">Veuillez poser votre badge contre le lecteur au dessus de cet écran !</p>

        <button class="micro" (click)="toggleCheckedModal()">
          <img src="/assets/icons/waves.png" width="50" alt="">
        </button>
      </div>

      <div class="modal" *ngIf="checkedModalVisibility">
        <!-- Modal content -->
        <div class="modal-container">
          <div class="modal-content modal-green">
          <span (click)="toggleCheckedModal()">
          <img class="icon info" src="./assets/icons/close_modal.svg" alt="">
          </span>

            <div class="modal-header">
              <p class="modal-title m-b">L'{{ team.id }} {{ teamDetailsForm.value.teamName }} est prête !</p>

              <div *ngIf="allTeamAreCompleted()">
                <p class="modal-final-title">{{form.value.groupName ?? teamDetailsForm.value.teamName}} vos équipes sont formés, dirigez-vous vers votre gamemaster !</p>
              </div>
            </div>


            <button class="check-valid" cdkStepperNext (click)="sendDataIfAllTeamAreCompleted()">
              <img class="icon check" src="./assets/icons/check.svg" alt="">
            </button>
          </div>
        </div>
      </div>
    </cdk-step>
  </div>
</form-wizard>
